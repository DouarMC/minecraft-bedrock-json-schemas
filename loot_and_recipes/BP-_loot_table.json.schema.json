{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "description": "Schéma pour les fichiers de Loot Table.",
    "type": "object",
    "required": ["pools"],
    "properties": {
        "pools": {
            "description": "Repertorie toutes les Pools.",
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "conditions": {
                        "description": "Contient toutes les conditions à valider pour que cette Pool s'execute. (ou modificateur de Pool)",
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "condition": {
                                    "description": "Le type de condition.",
                                    "type": "string",
                                    "enum": ["killed_by_player", "killed_by_player_or_pets", "random_chance", "random_chance_with_looting", "random_difficulty_chance", "random_regional_difficulty_chance", "match_tool", "killed_by_entity", "entity_properties", "entity_killed"]
                                }
                            },
                            "dependencies": {
                                "condition": {
                                    "oneOf": [
                                        {
                                            "properties": {
                                                "condition": {
                                                    "enum": ["killed_by_player", "killed_by_player_or_pets"]
                                                }
                                            }
                                        },
                                        {
                                            "properties": {
                                                "condition": {
                                                    "enum": ["has_mark_variant", "has_variant"]
                                                },
                                                "value": {
                                                    "description": "La valeur de la condition.",
                                                    "type": "integer"
                                                }
                                            }
                                        },
                                        {
                                            "properties": {
                                                "condition": {
                                                    "enum": ["random_chance", "random_chance_with_looting"]
                                                },
                                                "chance": {
                                                    "description": "Le pourcentage de chance.",
                                                    "type": "number"
                                                }
                                            }
                                        },
                                        {
                                            "properties": {
                                                "condition": {
                                                    "enum": ["random_chance_with_looting"]
                                                },
                                                "looting_multiplier": {
                                                    "description": "Le multiplicateur de chance.",
                                                    "type": "number"
                                                }
                                            }
                                        },
                                        {
                                            "properties": {
                                                "condition": {
                                                    "enum": ["random_difficulty_chance"]
                                                },
                                                "default_chance": {
                                                    "description": "La chance par défaut.",
                                                    "type": "number"
                                                },
                                                "peaceful": {
                                                    "description": "La chance en mode pacifique.",
                                                    "type": "number"
                                                },
                                                "easy": {
                                                    "description": "La chance en mode facile.",
                                                    "type": "number"
                                                },
                                                "normal": {
                                                    "description": "La chance en mode normal.",
                                                    "type": "number"
                                                },
                                                "hard": {
                                                    "description": "La chance en mode difficile.",
                                                    "type": "number"
                                                }
                                            }
                                        },
                                        {
                                            "properties": {
                                                "condition": {
                                                    "enum": ["random_regional_difficulty_chance"]
                                                },
                                                "max_chance": {
                                                    "description": "La chance maximale.",
                                                    "type": "number"
                                                }
                                            }
                                        },
                                        {
                                            "properties": {
                                                "condition": {
                                                    "enum": ["match_tool"]
                                                },
                                                "count": {
                                                    "description": "Le nombre d'item.",
                                                    "oneOf": [
                                                        {
                                                            "type": "object",
                                                            "properties": {
                                                                "range_min": {"type": "integer"},
                                                                "range_max": {"type": "integer"}
                                                            }
                                                        },
                                                        {
                                                            "type": "integer"
                                                        }
                                                    ]
                                                },
                                                "durability": {
                                                    "oneOf": [
                                                        {
                                                            "type": "object",
                                                            "properties": {
                                                                "range_min": {
                                                                    "description": "La durabilité minimale.",
                                                                    "type": "integer"
                                                                },
                                                                "range_max": {
                                                                    "description": "La durabilité maximale.",
                                                                    "type": "integer"
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "type": "integer"
                                                        }
                                                    ]
                                                },
                                                "enchantments": {
                                                    "description": "Les enchantements.",
                                                    "type": "array",
                                                    "items": {
                                                        "type": "object",
                                                        "properties": {
                                                            "enchantment": {
                                                                "description": "Le nom de l'enchantement.",
                                                                "type": "string"
                                                            },
                                                            "levels": {
                                                                "oneOf": [
                                                                    {
                                                                        "type": "object",
                                                                        "properties": {
                                                                            "range_min": {
                                                                                "description": "Le niveau minimum.",
                                                                                "type": "integer"
                                                                            },
                                                                            "range_max": {
                                                                                "description": "Le niveau maximum.",
                                                                                "type": "integer"
                                                                            }
                                                                        }
                                                                    },
                                                                    {
                                                                        "type": "integer"
                                                                    }
                                                                ]
                                                            }
                                                        }
                                                    }
                                                },
                                                "item": {
                                                    "description": "Le nom de l'item.",
                                                    "type": "string"
                                                }
                                            }
                                        },
                                        {
                                            "properties": {
                                                "condition": {
                                                    "enum": ["killed_by_entity", "entity_killed"]
                                                },
                                                "entity_type": {
                                                    "description": "Le type d'entité.",
                                                    "type": "string"
                                                }
                                            }
                                        },
                                        {
                                            "properties": {
                                                "condition": {
                                                    "enum": ["entity_properties"]
                                                },
                                                "entity": {
                                                    "description": "L'entité.",
                                                    "type": "string",
                                                    "enum": ["this"]
                                                },
                                                "properties": {
                                                    "description": "Les propriétés de l'entité.",
                                                    "type": "object",
                                                    "additionalProperties": {
                                                        "oneOf": [
                                                            {
                                                                "type": "boolean"
                                                            },
                                                            {
                                                                "type": "number"
                                                            },
                                                            {
                                                                "type": "string"
                                                            }
                                                        ]
                                                    }
                                                }
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    },
                    "rolls": {
                        "description": "Le nombre de lancers aléatoires.",
                        "oneOf": [
                            {
                                "type": "object", 
                                "properties": {
                                    "min": {
                                        "description": "Le nombre minimum de lancers.",
                                        "type": "integer"
                                    },
                                    "max": {
                                        "description": "Le nombre maximum de lancers.",
                                        "type": "integer"
                                    }
                                }
                            },
                            {
                                "type": "integer"
                            }
                        ]
                    },
                    "bonus_rolls": {
                        "description": "Le nombre de lancer en bonus quand le joueur a l'effet de Chance.",
                        "type": "number"
                    },
                    "tiers": {
                        "description": "La Pool devient hierachisé. Elle suit un ordre pour choisir une seule des entrées de Loot à partir d'un index choisi aléatoirement.",
                        "type": "object",
                        "properties": {
                            "initial_range": {
                                "description": "Définie la range pour choisir l'index initial.",
                                "type": "number"
                            },
                            "bonus_rolls": {
                                "description": "Le nombre de lancer pour avoir une chance de passer à l'index suivant.",
                                "type": "number"
                            },
                            "bonus_chance": {
                                "description": "Le pourcentage de chance que l'index incrémente lors d'un lancer.",
                                "type": "number"
                            }
                        }
                    },
                    "entries": {
                        "description": "Contient toutes les entrées de Loot.",
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "conditions": {
                                    "description": "Contient toutes les conditions à valider pour que cette entrée de Loot s'execute. (ou modificateur de Loot)",
                                    "$ref": "#/properties/pools/items/properties/conditions"
                                },
                                "type": {
                                    "description": "Définit le type de Loot.",
                                    "type": "string",
                                    "enum": ["item", "loot_table", "empty"]
                                },
                                "name": {
                                    "description": "Définit le type d'item.",
                                    "type": "string"
                                },
                                "weight": {
                                    "description": "Définit le poids de chance de cette entrée.",
                                    "type": "number"
                                },
                                "functions": {
                                    "description": "Contient les différentes fonctions qui appliqueront des modifications à l'Item de l'entrée de Loot.",
                                    "$ref": "../common.schema.json#/definitions/item_functions"
                                }
                            }
                        }
                    },
                    "quality": {
                        "description": "Définit le poids de l'entrée en fonction de la chance du joueur.",
                        "type": "integer"
                    }
                }
            }
        }
    }
}